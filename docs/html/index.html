<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LIN Middleware</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LIN Middleware</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">LIN Middleware </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The LIN middleware implements LIN 2.2 Slave node for the PSoC 4 devices. Options for the ISO 17987 is also available. The LIN Configurator tool makes it easy to configure the middleware.</p>
<p><b>Features:</b></p><ul>
<li>Full LIN 2.2 Slave Node implementation</li>
<li>Compliance with ISO 17987 specification</li>
<li>Full transport layer support</li>
<li>Automatic baud rate synchronization</li>
<li>Automatic detection of bus inactivity</li>
<li>Automatic configuration services</li>
<li>Fully implements a Diagnostic Class I Slave Node</li>
<li>Supports implementation of Diagnostic Class II and III Slave Node</li>
<li>Full error detection</li>
<li><a class="el" href="index.html#section_lin_configurator">LIN Configurator</a></li>
</ul>
<h1><a class="anchor" id="section_lin_general_description"></a>
General Description</h1>
<p>Include mtb_lin.h to get access to all the functions and other declarations in this middleware. See the <a class="el" href="index.html#section_lin_quick_start">Quick Start Guide</a> to start using the middleware.</p>
<p>Refer to the release notes for compatibility information.</p>
<p>Refer to the <a class="el" href="index.html#section_lin_spec_conformance">Specification Conformance</a> section for the API deviation from the specification.</p>
<p>The <a class="el" href="index.html#section_lin_configuration_considerations">Configuration Considerations</a> section provides the guidance for all operation modes and use cases.</p>
<h1><a class="anchor" id="section_lin_quick_start"></a>
Quick Start Guide</h1>
<p>LIN middleware can be used in various Development Environments. Refer to the release notes.</p>
<p>This quick start guide is for an environment with the configured:</p><ul>
<li>CAT2 Peripheral Driver Library (mtb-pdl-cat2)</li>
<li>ModusToolbox Hardware Abstraction Layer (mtb-hal-cat2)</li>
<li>Core Library (core-lib)</li>
</ul>
<p>The below steps describe the simplest way of enabling the LIN Slave.</p>
<h2><a class="anchor" id="subsection_qsg_step1"></a>
STEP 1: Enable the LIN middleware.</h2>
<p>Launch ModusToolbox Library Manager and enable the LIN middleware. This step is required only if the ModusToolbox IDE is used. Otherwise, ensure the LIN Middleware is included in your project.</p>
<h2><a class="anchor" id="subsection_qsg_step2"></a>
STEP 2: Generate initialization code.</h2>
<p>The following code snippet shows the mtbcfg_lin.h header file with the configuration generated by the LIN configurator: </p><div class="fragment"><div class="line"><span class="preprocessor">#ifndef MTBCFG_LIN_H</span></div><div class="line"><span class="preprocessor">#define MTBCFG_LIN_H</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;mtb_lin_types.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">extern</span> <a class="code" href="structmtb__stc__lin__config__t.html">mtb_stc_lin_config_t</a> <span class="keyword">const</span> mtb_lin_0_config;</div><div class="line"></div><div class="line"><span class="comment">/* Signal handles used for signal interaction functions. The handle value for a</span></div><div class="line"><span class="comment"> * signal matches the value of the handle member of the mtb_stc_lin_signal_t</span></div><div class="line"><span class="comment"> * array. The signals with the same name share the same signal handle.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#define MTB_LIN_0_SIGNAL_HANDLE_Response_Error             (0x0000U)</span></div><div class="line"><span class="preprocessor">#define MTB_LIN_0_SIGNAL_HANDLE_SignalIn                   (0x0001U)</span></div><div class="line"><span class="preprocessor">#define MTB_LIN_0_SIGNAL_HANDLE_SignalOut                  (0x0002U)</span></div><div class="line"></div><div class="line"><span class="comment">/* The low 16 bits minus one corresponds to the signal index in the signals&#39;</span></div><div class="line"><span class="comment"> *  configuration array. The every signal has its own flag handle. The signals</span></div><div class="line"><span class="comment"> *  with the same name have different flag handles.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  The high 16 bits minus one corresponds to the frame index in the frames&#39;s</span></div><div class="line"><span class="comment"> *  configuration array.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#define MTB_LIN_0_FLAG_HANDLE_Response_Error               (0x00000001U)</span></div><div class="line"><span class="preprocessor">#define MTB_LIN_0_FLAG_HANDLE_SignalIn                     (0x00000002U)</span></div><div class="line"><span class="preprocessor">#define MTB_LIN_0_FLAG_HANDLE_SignalOut                    (0x00000003U)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define MTB_LIN_0_FLAG_HANDLE_FrameIn                      (0x00010000U)</span></div><div class="line"><span class="preprocessor">#define MTB_LIN_0_FLAG_HANDLE_FrameOut                     (0x00020000U)</span></div><div class="line"><span class="preprocessor">#define MTB_LIN_0_FLAG_HANDLE_MRF                          (0x00030000U)</span></div><div class="line"><span class="preprocessor">#define MTB_LIN_0_FLAG_HANDLE_SRF                          (0x00040000U)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* MTBCFG_LIN_H */</span><span class="preprocessor"></span></div><div class="line"></div></div><!-- fragment --><p> The following code snippet shows the mtbcfg_lin.c source file with the configuration generated by the LIN configurator: </p><div class="fragment"><div class="line"><span class="comment">/* Frames declaration with initial signals values */</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <a class="code" href="group__group__lin__data__structures__data__types.html#ga4ec6e5bc7f4a484f2dad5b664711433f">l_u8</a>  mtb_lin_0_buffer_FrameIn[7U] =</div><div class="line">    { 0x00U, 0xFFU, 0xFFU, 0xFFU, 0xFFU, 0xFFU, 0xFFU };</div><div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <a class="code" href="group__group__lin__data__structures__data__types.html#ga4ec6e5bc7f4a484f2dad5b664711433f">l_u8</a>  mtb_lin_0_buffer_FrameOut[6U] = { 0xFEU, 0x00U, 0xFFU, 0xFFU, 0xFFU, 0xFFU };</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/* The frames&#39; context structure used for the frames&#39; runtime attributes.</span></div><div class="line"><span class="comment"> * The size of the array equals to the number of all frames defined plus</span></div><div class="line"><span class="comment"> * additional space for the MRF and SRF frames.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><a class="code" href="structmtb__stc__lin__frame__context__t.html">mtb_stc_lin_frame_context_t</a> mtb_lin_0_frames_context[4U];</div><div class="line"><a class="code" href="structmtb__stc__lin__signal__context__t.html">mtb_stc_lin_signal_context_t</a> mtb_lin_0_signals_context[3U];</div><div class="line"></div><div class="line"><span class="comment">/* The Master Request Frame (MRF) buffer */</span></div><div class="line"><span class="keyword">volatile</span> <a class="code" href="group__group__lin__data__structures__data__types.html#ga4ec6e5bc7f4a484f2dad5b664711433f">l_u8</a> mtb_lin_0_raw_rx_buffer[32U];</div><div class="line"></div><div class="line"><span class="comment">/* The Slave Response Frame (SRF) buffer */</span></div><div class="line"><span class="keyword">volatile</span> <a class="code" href="group__group__lin__data__structures__data__types.html#ga4ec6e5bc7f4a484f2dad5b664711433f">l_u8</a> mtb_lin_0_raw_tx_buffer[32U];</div><div class="line"></div><div class="line"><span class="keyword">volatile</span> <a class="code" href="structmtb__stc__lin__frame__t.html">mtb_stc_lin_frame_t</a> <span class="keyword">const</span> mtb_lin_0_frames[] =</div><div class="line">{</div><div class="line">    {</div><div class="line">        <span class="comment">// Index: 0,</span></div><div class="line">        <span class="comment">// &quot;FrameIn&quot;</span></div><div class="line">        .<a class="code" href="structmtb__stc__lin__frame__t.html#a0cd6b328a3bf1ab13bf9a9f1ece50888">initial_pid</a> = 0xC1U,</div><div class="line">        .direction  = <a class="code" href="group__group__lin__enums.html#gga6ff9a0b5405389c605a843ac11caf590add2f8b1b318646cb16e83cb8d3ee7181">MTB_LIN_FRAME_DIR_SUBSCRIBE</a>,</div><div class="line">        .size       = 7U,</div><div class="line">        .type       = <a class="code" href="group__group__lin__enums.html#gga82fdccf4c275633abb9e610f43922326a9373f22a633a3ff3411dd1be78765d43">MTB_LIN_FRAME_TYPE_UNCONDITIONAL</a>,</div><div class="line">        .data       = mtb_lin_0_buffer_FrameIn,</div><div class="line">    },</div><div class="line">    {</div><div class="line">        <span class="comment">// Index: 1,</span></div><div class="line">        <span class="comment">// &quot;FrameOut&quot;</span></div><div class="line">        .initial_pid = 0x80U,</div><div class="line">        .direction  = <a class="code" href="group__group__lin__enums.html#gga6ff9a0b5405389c605a843ac11caf590afe8c244af89ce7eb23e87b02d6bcde33">MTB_LIN_FRAME_DIR_PUBLISH</a>,</div><div class="line">        .size       = 6U,</div><div class="line">        .type       = <a class="code" href="group__group__lin__enums.html#gga82fdccf4c275633abb9e610f43922326a9373f22a633a3ff3411dd1be78765d43">MTB_LIN_FRAME_TYPE_UNCONDITIONAL</a>,</div><div class="line">        .data       = mtb_lin_0_buffer_FrameOut,</div><div class="line">    },</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">/* Signal handles used for signal interaction functions.</span></div><div class="line"><span class="comment"> * The handle value for a signal matches index in mtb_lin_0_signals[]. */</span></div><div class="line"><a class="code" href="structmtb__stc__lin__signal__t.html">mtb_stc_lin_signal_t</a> <span class="keyword">const</span> mtb_lin_0_signals[] =</div><div class="line">{</div><div class="line">    {</div><div class="line">        <span class="comment">// Index: 0</span></div><div class="line">        <span class="comment">// &quot;Response_Error&quot;</span></div><div class="line">        .<a class="code" href="structmtb__stc__lin__signal__t.html#a3fbf23cb0ab3c5914da618bce81ca234">handle</a> = 0U,</div><div class="line">        .frame_index = 1U,</div><div class="line">        .bit_offset  = 0U,</div><div class="line">        .type       = <a class="code" href="group__group__lin__enums.html#ggadc15e9982a59073672d6c30672ee758ba8f17ece38327051a6aab564430228b74">MTB_LIN_SIGNAL_TYPE_SCALAR_BOOL</a>,</div><div class="line">        .size       = 1U,</div><div class="line">    },</div><div class="line">    {</div><div class="line">        <span class="comment">// Index: 1</span></div><div class="line">        <span class="comment">// &quot;SignalIn&quot;</span></div><div class="line">        .handle = 1U,</div><div class="line">        .frame_index = 0U,</div><div class="line">        .bit_offset  = 0U,</div><div class="line">        .type       = <a class="code" href="group__group__lin__enums.html#ggadc15e9982a59073672d6c30672ee758ba36818763dfd35b67aabb914c5b460c5b">MTB_LIN_SIGNAL_TYPE_SCALAR_U8</a>,</div><div class="line">        .size       = 8U,</div><div class="line">    },</div><div class="line">    {</div><div class="line">        <span class="comment">// Index: 2</span></div><div class="line">        <span class="comment">// &quot;SignalOut&quot;</span></div><div class="line">        .handle = 2U,</div><div class="line">        .frame_index = 1U,</div><div class="line">        .bit_offset  = 8U,</div><div class="line">        .type       = <a class="code" href="group__group__lin__enums.html#ggadc15e9982a59073672d6c30672ee758ba36818763dfd35b67aabb914c5b460c5b">MTB_LIN_SIGNAL_TYPE_SCALAR_U8</a>,</div><div class="line">        .size       = 8U,</div><div class="line">    },</div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="structmtb__stc__lin__config__t.html">mtb_stc_lin_config_t</a> <span class="keyword">const</span> mtb_lin_0_config =</div><div class="line">{</div><div class="line">    .<a class="code" href="structmtb__stc__lin__config__t.html#ad4285a092a4c9abb61bbe8e8c184c636">spec</a>                          = <a class="code" href="group__group__lin__enums.html#ggada3dec53cdedc6578a0a980304799fcbad0c121e5677481c3938739b1f392db97">MTB_LIN_SPEC_2_2</a>,</div><div class="line">    .iso17987                      = <span class="keyword">false</span>,</div><div class="line">    .inactivity_enabled            = <span class="keyword">true</span>,</div><div class="line">    .inactivity_threshold          = 7000U,</div><div class="line">    .break_threshold               = 11U,</div><div class="line"></div><div class="line">    .auto_baud_rate_sync           = <span class="keyword">true</span>,</div><div class="line">    .baud_rate                     = 9600U,</div><div class="line"></div><div class="line">    <span class="comment">/* Transport Layer */</span></div><div class="line">    .tl_enabled                    = <span class="keyword">true</span>,</div><div class="line">    .initial_nad                   = 0x10U,</div><div class="line">    .tl_api_format                 = <a class="code" href="group__group__lin__enums.html#gga6b5bc85c89075256fafbe503bc4d9573ac5f993dfe4138155843345e285961ed4">MTB_LIN_TL_FORMAT_RAW</a>,</div><div class="line">    .tl_buf_len_max                = 512U,</div><div class="line">    .tl_tx_queue_len               = 32U,</div><div class="line">    .tl_rx_queue_len               = 32U,</div><div class="line">    .tl_raw_rx_queue               = mtb_lin_0_raw_rx_buffer,</div><div class="line">    .tl_raw_tx_queue               = mtb_lin_0_raw_tx_buffer,</div><div class="line"></div><div class="line">    <span class="comment">/* Automatic Configuration Request Handling */</span></div><div class="line">    .auto_config_request_handling  = <span class="keyword">true</span>,</div><div class="line">    .supplier_id                   = 0x7ffeU,</div><div class="line">    .function_id                   = 0x4841U,</div><div class="line">    .variant                       = 0x00U,</div><div class="line">    .service_assign_nad            = <span class="keyword">true</span>,</div><div class="line">    .service_assign_frame_id       = <span class="keyword">false</span>,</div><div class="line">    .service_read_by_id            = <span class="keyword">true</span>,</div><div class="line">    .service_cond_change_nad       = <span class="keyword">true</span>,</div><div class="line">    .service_data_dump             = <span class="keyword">false</span>,</div><div class="line">    .service_target_reset          = <span class="keyword">false</span>,</div><div class="line">    .service_save_config           = <span class="keyword">true</span>,</div><div class="line">    .service_assign_frame_id_range = <span class="keyword">true</span>,</div><div class="line"></div><div class="line">    <span class="comment">/* General frames and signals information */</span></div><div class="line">    .num_of_frames                 = 2U,</div><div class="line">    .num_of_signals                = 3U,</div><div class="line">    .num_of_signal_handles         = 3U,</div><div class="line"></div><div class="line">    .resp_error_signal_handle      = MTB_LIN_0_SIGNAL_HANDLE_Response_Error,</div><div class="line"></div><div class="line">    .frames                        = mtb_lin_0_frames,</div><div class="line">    .signals                       = mtb_lin_0_signals,</div><div class="line"></div><div class="line">    .frames_context                = mtb_lin_0_frames_context,</div><div class="line">    .signals_context               = mtb_lin_0_signals_context,</div><div class="line"></div><div class="line">    .file_rev_defined              = <span class="keyword">false</span>,</div><div class="line">};</div></div><!-- fragment --> <h2><a class="anchor" id="subsection_qsg_step3"></a>
STEP 3: Update main.c</h2>
<p>The following code snippet shows the LIN initialization: </p><div class="fragment"><div class="line"><span class="comment">/* Instance number */</span></div><div class="line"><span class="preprocessor">#define LIN_IFC_HANDLE          (0U)</span></div><div class="line"></div><div class="line"><span class="comment">/* Interrupt priority for SCB ISR */</span></div><div class="line"><span class="preprocessor">#define LIN_SCB_INT_PRIORITY    (0U)</span></div><div class="line"></div><div class="line"><span class="comment">/* Allocate context for LIN operation */</span></div><div class="line"><a class="code" href="structmtb__stc__lin__context__t.html">mtb_stc_lin_context_t</a> lin_context;</div><div class="line"></div><div class="line"><span class="comment">/* Implement SCB ISR for LIN */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> LIN_Isr(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group__group__lin__core__api__interface__management__function.html#ga0d339836c3b608548c93841ac3a13eb8">l_ifc_rx</a>(LIN_IFC_HANDLE, &amp;lin_context);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/* Implement Inactivity ISR for LIN */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> LIN_InactivityIsr(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group__group__lin__core__api__interface__management__function.html#gad2e71cfa4662f25a4785a3194be79676">l_ifc_aux</a>(LIN_IFC_HANDLE, &amp;lin_context);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*******************************************************************************</span></div><div class="line"><span class="comment">* Function Name: LIN_start</span></div><div class="line"><span class="comment">****************************************************************************/</span></div><div class="line"><span class="keywordtype">void</span> LIN_start()</div><div class="line">{</div><div class="line">    <span class="comment">/* Initializes the LIN core that is specified by the context structure */</span></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__lin__core__api__initialization__function.html#gae8e2e24edacbf0c3b79369eedf6564b4">l_sys_init</a>(&amp;mtb_lin_0_config, &amp;lin_context, &amp;LIN_Isr, LIN_SCB_INT_PRIORITY,</div><div class="line">                   &amp;LIN_InactivityIsr))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Stop program execution if sys init failed */</span></div><div class="line">        CY_ASSERT(0U);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* Initializes the LIN instance that is specified by the context structure.</span></div><div class="line"><span class="comment">     * Choose appropriate pins for tx and rx direction from HAL library. */</span></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__lin__core__api__interface__management__function.html#ga21ed37a9006dfa7152b6737e964d61ca">l_ifc_init</a>(LIN_IFC_HANDLE, &amp;lin_context, P0_4, P0_5))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Stop program execution if ifc init failed */</span></div><div class="line">        CY_ASSERT(0U);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"></div></div><!-- fragment --> <h2><a class="anchor" id="subsection_qsg_step4"></a>
STEP 4: Hardware Configuration</h2>
<p>Use LIN hardware like CY8CKIT-026-CAN and Lin Shield Kit and CY8CKIT-041S-MAX PSoC 4100S Max Pioneer kit.</p>
<h2><a class="anchor" id="subsection_qsg_step5"></a>
STEP 5: Build and program the device.</h2>
<p>Connect the device to the LIN Master. Configure LIN Master to send frames and observe updated signals in the LIN Slave application.</p>
<h1><a class="anchor" id="section_lin_configuration_considerations"></a>
Configuration Considerations</h1>
<p>This section consists of different guides and instruction of how to enable, configure, and use the LIN middleware in a design. As you can see from the <a class="el" href="index.html#section_lin_quick_start">Quick Start Guide</a> section, the settings of the LIN middleware are controlled with the <a class="el" href="structmtb__stc__lin__config__t.html">mtb_stc_lin_config_t</a> structure. Please see its description to learn about the parameters and values.</p>
<p>The following is a description of the most common use cases along with the configuration structure examples and code snippets. The list of sections under Configuration Considerations:</p>
<ul>
<li><a class="el" href="index.html#section_lin_operating_modes">Operating Modes</a></li>
<li><a class="el" href="index.html#section_lin_interrupt">Interrupts</a></li>
<li><a class="el" href="index.html#section_lin_spec_conformance">Specification Conformance</a></li>
<li><a class="el" href="index.html#section_lin_resources">Resources</a></li>
</ul>
<h2><a class="anchor" id="section_lin_configurator"></a>
LIN Configurator</h2>
<p>The standalone LIN Configurator tool helps configure the middleware. The tool output are generated source and header files. Generated files are mandatory for the middleware operation and must be added to your project. The header file provides access to instances of the LIN configuration structure <a class="el" href="structmtb__stc__lin__config__t.html">mtb_stc_lin_config_t</a>.</p>
<p>The LIN Configurator tool provides the User Guide, which can be found in the documentation.</p>
<h2><a class="anchor" id="section_lin_operating_modes"></a>
Operating Modes</h2>
<p>The settings of the LIN middleware are controlled by the <a class="el" href="structmtb__stc__lin__config__t.html">mtb_stc_lin_config_t</a> structure. See its description to learn about the parameters and values.</p>
<h2><a class="anchor" id="section_lin_interrupt"></a>
Interrupts</h2>
<p>The interrupt is mandatory for LIN middleware operation. The LIN middleware requires two interrupt sources for the proper operation: one for UART operation, other for SysTick timer operation.</p>
<p>The Bus Inactivity Timer is based on the SysTick timer. It is configured by default at Reset time to interrupt a period of 1 millisecond. The LIN middleware uses one callback handler (out of five) from the SysTick timer for one instance. The SysTick timer is configured and enabled automatically during initialization.</p>
<p>The UART interrupt has the configurable priority. Ensure that the UART priority has a level sufficient for a timely response to events on the bus.</p>
<h2><a class="anchor" id="section_lin_resources"></a>
Resources</h2>
<p>This section describes the software and hardware resources used by the middleware.</p>
<ul>
<li>For the PSoC 4 devices, the middleware is based on the SCB block.</li>
<li>If Bus Inactivity is enabled, the middleware registers a callback from PDL SysTick driver.</li>
<li>The project described in the <a class="el" href="index.html#section_lin_quick_start">Quick Start Guide</a> section, compiled with the GCC compiler's -Og option for CY8C4149AZI-S598 consumes around 33 KB of flash memory and around 800 bytes of RAM memory. The consumption reported for RAM memory is for the .data and .bss sections, without the heap, stack and RAM vectors sections.</li>
</ul>
<h2><a class="anchor" id="section_lin_spec_conformance"></a>
Specification Conformance</h2>
<p>This section describes the deviations from the API defined by the LIN specifications.</p>
<ul>
<li>The following deviations are applicable to all functions:<ul>
<li>There are no static functions available. The middleware provides only the dynamic prototypes.</li>
<li>The interface of each function accepts the pointer to <a class="el" href="structmtb__stc__lin__context__t.html">mtb_stc_lin_context_t</a> as a parameter. The context holds the state of the LIN interfaces.</li>
<li>The interface handle parameter of the Interface Management functions is ignored. The context is used to differentiate between the interfaces instead.</li>
</ul>
</li>
<li>The following functions have the following interface changes:<ul>
<li>The list of parameters and return value of the <a class="el" href="group__group__lin__core__api__initialization__function.html#gae8e2e24edacbf0c3b79369eedf6564b4">l_sys_init()</a> function.</li>
<li>The list of the <a class="el" href="group__group__lin__core__api__interface__management__function.html#ga21ed37a9006dfa7152b6737e964d61ca">l_ifc_init()</a> function parameters extended with the RX and TX pin configuration.</li>
<li>The return type of the <a class="el" href="group__group__lin__core__api__interface__management__function.html#ga596ce4b306e2d541b204f2774780ca26">l_ifc_ioctl()</a> function changed from l_u16 to <a class="el" href="group__group__lin__enums.html#ga23dca27bbddeba070d1ccb0f1522afd3">mtb_lin_status_t</a> for the enhanced status reporting.</li>
<li>The data length parameter added to the <a class="el" href="group__group__lin__node__configuration__function.html#ga1e8ace2e0fbbfe41a118532c16e8e0eb">ld_read_by_id_callout()</a> function.</li>
</ul>
</li>
<li>The deviations from the ISO 17987 specification are as follows:<ul>
<li>The optional big-endian signal encoding variant is not supported.</li>
<li>The optional SID B8 is not supported.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="section_lin_migration"></a>
API Changes between PSoC Creator Component and Middleware</h2>
<p>This section describes the differences between PSoC Creator LIN component and the LIN middleware API.</p>
<table class="doxtable">
<tr>
<th># </th><th>PSoC Creator LIN component </th><th>LIN middleware  </th></tr>
<tr>
<td>1 </td><td>The result of the <a class="el" href="group__group__lin__l__ifc__ioctl__parameters__macros.html#gaaff091297e0f4340bd08dd7c5aaed20f">MTB_LIN_IOCTL_READ_STATUS</a> operation of the <a class="el" href="group__group__lin__core__api__interface__management__function.html#ga596ce4b306e2d541b204f2774780ca26">l_ifc_ioctl()</a> is returned by the function.  </td><td>The result of the <a class="el" href="group__group__lin__l__ifc__ioctl__parameters__macros.html#gaaff091297e0f4340bd08dd7c5aaed20f">MTB_LIN_IOCTL_READ_STATUS</a> operation of the <a class="el" href="group__group__lin__core__api__interface__management__function.html#ga596ce4b306e2d541b204f2774780ca26">l_ifc_ioctl()</a> is returned via the pointer specified by the pv parameter. The function returns <a class="el" href="group__group__lin__enums.html#gga23dca27bbddeba070d1ccb0f1522afd3a8acaabea6d29858f2d8ca97c7690453a">MTB_LIN_STATUS_SUCCESS</a>.   </td></tr>
<tr>
<td>2 </td><td>No <a class="el" href="group__group__lin__core__api__user__callouts.html#ga16813560dde8b3f6c56028b13139ddf1" title="Disables the LIN communication interrupts. ">l_sys_irq_disable()</a> and <a class="el" href="group__group__lin__core__api__user__callouts.html#gad9f472f1bb651e8d200e382670358c20" title="Restores the interrupt level identified by the provided parameter. ">l_sys_irq_restore()</a> implemented.  </td><td>Added implementation of the <a class="el" href="group__group__lin__core__api__user__callouts.html#ga16813560dde8b3f6c56028b13139ddf1">l_sys_irq_disable()</a> and <a class="el" href="group__group__lin__core__api__user__callouts.html#gad9f472f1bb651e8d200e382670358c20">l_sys_irq_restore()</a>.   </td></tr>
<tr>
<td>3 </td><td>All the interrupt service routines are initialized inside of the component - no any actions required on the application level.  </td><td>The communication and inactivity interrupt service routines should be implemented on the application level. Refer to the <a class="el" href="index.html#subsection_qsg_step3">STEP 3: Update main.c</a> section for the more details.   </td></tr>
</table>
<h1><a class="anchor" id="section_lin_MISRA"></a>
MISRA-C Compliance</h1>
<p>This section describes MISRA-C:2012 compliance and deviations for the LIN.</p>
<p>MISRA stands for Motor Industry Software Reliability Association. The MISRA specification covers a set of 10 mandatory rules, 110 required rules, and 39 advisory rules that apply to the firmware design and has been put together by the Automotive Industry to enhance the quality and robustness of the firmware code embedded in automotive devices.</p>
<p>The MISRA specification defines two categories of deviations (see section 5.4 of the MISRA-C:2012 specification):</p><ul>
<li>Project Deviations - applicable for a particular class of deviations.</li>
<li>Specific Deviations - applicable for a single instance in a single file.</li>
</ul>
<p>Project Deviations and Specific Deviations are documented later in this section.</p>
<p>Specific deviations are also documented in the source code, close to the deviation occurrence. For each deviation, a special macro identifies the relevant rule or directive number, and reason.</p>
<h2>Verification Environment</h2>
<p>This section provides a MISRA compliance analysis environment description.</p>
<table class="doxtable">
<tr>
<th>Component </th><th>Name </th><th>Version  </th></tr>
<tr>
<td>Test Specification </td><td>MISRA-C:2012 Guidelines for the use of the C language in critical systems </td><td>March 2013  </td></tr>
<tr>
<td rowspan="2">MISRA Checking Tool </td><td>Coverity Static Analysis Tool </td><td>2020.03  </td></tr>
</table>
<h2>Project and Specific Deviations</h2>
<p>The list of deviated rules is provided in the table below.</p>
<table class="doxtable">
<tr>
<th>MISRA Rule </th><th>Required/Advisory </th><th>Rule Description </th><th>Description of Deviation(s)  </th></tr>
<tr>
<td>1.2 </td><td>A </td><td>Language extensions are not used </td><td>The middleware library supports ISO:C99 standard.  </td></tr>
<tr>
<td>2.5 </td><td>A </td><td>A project does not contain unused macro definitions </td><td>The middleware library provides an API to the hardware. The macro is part of the API, which is defined for the application-level only.  </td></tr>
<tr>
<td>3.1 </td><td>R </td><td>The special comment symbols is not used within a comment </td><td>Special comment symbols are required for Doxygen comment support, it does not have any impact.  </td></tr>
<tr>
<td>8.7 </td><td>A </td><td>Functions and objects are not defined with external linkage if they are referenced in only one translation unit </td><td>The middleware library provides an API to the hardware. The functions and objects with external linkage are part of the API, which are defined for application-level only.  </td></tr>
<tr>
<td>11.4 </td><td>A </td><td>A conversion are not performed between the pointer to an object and an integer type </td><td>The cast from an unsigned integer to the pointer does not have any unintended effect, as it is a consequence of the definition of a structure based on hardware registers.  </td></tr>
<tr>
<td>11.5 </td><td>A </td><td>A conversion is not performed from the pointer to void into the pointer to an object </td><td>See specific deviations documented in the source code, close to the deviation occurrence.  </td></tr>
<tr>
<td>18.4 </td><td>A </td><td>The +, -, += and -= operators are not applied to an expression of the pointer type </td><td>See specific deviations documented in the source code, close to the deviation occurrence.  </td></tr>
<tr>
<td>Directive 4.8 </td><td>A </td><td>If a pointer to the structure or union is never dereferenced within a translation unit, then the implementation of the object is hidden </td><td>Deviated, since the object provided by HAL is used without dereferencing for the own needs of LIN middleware.  </td></tr>
<tr>
<td>Directive 4.9 </td><td>A </td><td>A function is used in preference to a function-like macro where they are interchangeable </td><td>Deviated, since function-like macros are used to allow more efficient code.  </td></tr>
</table>
<h1><a class="anchor" id="section_lin_changelog"></a>
Changelog</h1>
<table class="doxtable">
<tr>
<th>Version</th><th>Changes</th><th>Reason for Change </th></tr>
<tr>
<td>1.10 </td><td>Added CAT2 Hardware Abstraction Layers (mtb-hal-cat2) 2.x support./td&gt; </td><td></td></tr>
<tr>
<td>1.0 </td><td>Initial Version </td><td></td></tr>
</table>
<h1><a class="anchor" id="section_lin_more_information"></a>
More Information</h1>
<p>For more information, refer to the following documents:</p>
<ul>
<li><a href="https://www.cypress.com/products/modustoolbox-software-environment"><b>ModusToolbox Software Environment, Quick Start Guide, Documentation, and Videos</b> </a></li>
<li><a href="https://cypresssemiconductorco.github.io/mtb-pdl-cat2/pdl_api_reference_manual/html/index.html"><b>CAT2 Peripheral Driver Library</b> </a></li>
<li><a href="https://cypresssemiconductorco.github.io/mtb-hal-cat2/html/modules.html"><b>ModusToolbox Hardware Abstraction Layer (mtb-hal-cat2)</b> </a></li>
<li><a href="https://www.cypress.com/documentation/development-kitsboards/psoc-4100s-max-pioneer-kit-cy8ckit-041s-max"><b>PSoC 4100S Max Pioneer Kit (CY8CKIT-041S-Max)</b> </a></li>
<li><a href="https://www.cypress.com/documentation/development-kitsboards/cy8ckit-026-can-and-lin-shield-kit"><b>CY8CKIT-026 CAN and LIN Shield Kit</b> </a></li>
<li><a href="http://www.cypress.com"><b>Cypress Semiconductor</b> </a></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The links to the other software component's documentation (middleware and PDL) point to GitHub to the latest available version of the software. To get documentation of the specified version, download from GitHub and unzip the component archive. The documentation is available in the <em>docs</em> folder. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>LIN Middleware</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
